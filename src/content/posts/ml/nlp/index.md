---
title: 机器学习入门实践
published: 2025-01-31
description: ""
image: ""
tags: ["NLP"]
category: "ML"
draft: true
---

# 0 前言

本文是一个**机器学习**(Machine Learning, ML)的应用实践，适合初级编码水平的读者。

本文选择的实践内容是**基于统计的自然语言处理(Natural Language Processing, NLP)**，具体来说，是基于**朴素贝叶斯算法**训练的一个二分类器 —— 用于判断收到的邮件是否为垃圾邮件。

阅读完成之后，应该达到的目标:

- 1 理解**朴素贝叶斯算法**原理
- 2 了解**基于统计的自然语言处理**的原理
- 3 理解**机器学习模型**的原理
- 4 成功完成训练**机器学习模型**的实践
- 5 理解并运用**模型评价指标**

# 1 算法原理

> 笔者：算法原理了解一下就行，不用担心现在看不懂，在后文中，会进一步结合代码理解。

## 1.1 贝叶斯定理

贝叶斯定理的数学表达式如下：

$$
P(A \mid B) = \frac{P(B \mid A) P(A)}{P(B)}
$$

其中：

- P(A\B) 表示在事件 B 发生的条件下，事件 A 发生的概率（后验概率）。
- P(B\A) 表示在事件 A 发生的条件下，事件 B 发生的概率（似然）。
- P(A) 是事件 A 的先验概率。
- P(B) 是事件 B 的全概率。

## 1.2 定理的应用

如果我们得到 P(A \ B) 的值，那么就能根据一些条件来预测某些事情的发生了。

举例 1， P(“I'm fine.” \ “How are you ?”) ，根据经验，这两句话先后出现概率挺高的，其值假设为的 0.8 , 那么可以这样表述：当一个人对你说 “How are you ?” 时，你有 80% 的概率会回复他 “I′m fine.”

举例 2, P(“垃圾邮件” \ “期待您的光临，电话号码：153xxxx1234”) = 0.7

举例 3, P(“垃圾邮件” \ “我有朋友在那里工作。这个是个个人信箱亚，难道骗简历？”) = 0.01

总之，我们将 P 看作是一个函数（也就是模型），输入是字符串 B，输出是 P(A|B) 的值。

## 1.3 朴素贝叶斯

朴素贝叶斯是贝叶斯定理的一个**特例**，它简化了问题的假设前提，从而简化问题的解决过程。

**简化的假设前提**：假设特征之间是条件独立的，不考虑特征之间的关系（这也是“朴素”的含义）。

**特征**：事件 B 可能是由多个变量组成的一个集合，称为特征集。这些变量都能够影响最终的结果，被称为特征。

# 2 基于统计的 NLP

在 NLP 领域有两个研究方法：**基于规则的方法**和**基于统计的方法**。

本文对这两种方法的优劣不作评价，当然我们选择后者。

## 2.1 常规的处理流程

标准化的操作步骤是：

- 1、数据获取
- 2、数据预处理
- 3、特征提取
- 4、模型训练
- 5、模型评估

其中，第一步的数据获取，一般是用爬虫技术爬取数据，或者购买数据。我们这里准备好了<a href="/files/nlp/data.zip" target="_blank">训练数据</a>，直接下载即可。**严郑声明，仅用于学习用途！**

第二步的数据预处理，我们的训练数据也已经做好了。我们拿到的数据就是**有标记的**数据。

第五步的模型评估，不是本文的重点，直接略过。感兴趣的读者可以查阅**准确率、召回率、F1-score** 等概念。

代码实践部分，我们只做第三步和第四步。

## 2.2 特征提取

### 2.2.1 观察数据

在 2.1 节下载训练数据 data.zip 后，解压查看内部结构，应当是这样的：

```bash
➜  data tree -L 1
.
├── normal
├── spam
├── test
└── 中文停用词表.txt

4 directories, 1 file
```

其中，normal、spam、test 三个文件夹下都有若干 txt 文件，每个 txt 文件的内容是爬取的文本信息。

normal 表示其内都是正常邮件（个人笔记、好友消息等），spam 表示其内都是垃圾邮件（广告邮件之类的），test 用于测试。

从 normal 和 spam 中各取一份文件展示一下：

<details>
  <summary>某个 normal 文件</summary>

```txt
Return-Path: <chi@rbl.ccert.edu.cn>
Received: from rbl.ccert.edu.cn (rbl.ccert.edu.cn [202.112.57.71])
	by sea.net.edu.cn (8.12.11/8.12.11) with ESMTP id i9G08rJt015597
	for <han@ccert.edu.cn>; Sat, 16 Oct 2004 08:08:53 +0800 (CST)
Received: from rbl.ccert.edu.cn (localhost.localdomain [127.0.0.1])
	by rbl.ccert.edu.cn (8.12.11/8.12.11) with ESMTP id i9G0EVlm030752
	for <han@ccert.edu.cn>; Sat, 16 Oct 2004 08:14:32 +0800
Received: (from qa@localhost)
	by rbl.ccert.edu.cn (8.12.11/8.12.11/Submit) id i9G0EVSi030751;
	Sat, 16 Oct 2004 08:14:31 +0800
Date: Sat, 16 Oct 2004 08:14:31 +0800
Message-Id: <200410160014.i9G0EVSi030751@rbl.ccert.edu.cn>
Subject: =?gb2312?B?ofEgztK1xMXz09Eg0uy12MG1x+kg0KHM7Lbsyq608w==?=
To: han@ccert.edu.cn
From: Tran Quang Anh <chi@cernet.edu.cn>
Content-Type: multipart/mixed; boundary="----------=_1097885672-2811-72"
MIME-Version: 1.0
X-UIDL: )+[!!?A)"!%/l"!~XO"!

大三了,我们的恋情维系了三年.
   可是,越来越不知道自己在坚持什么.
   坚信他是最适合我的人，因为在一起的时候很快乐.
   可是一旦开学,被分开----距离拉开了，美没了
   因为相信地久天长,因为拿不起,放不下
   身为射手女生,是不是有点名不副实呢?
   吵架的时间居多,怀疑是否相爱,是否在乎对方,
   有时候嘲笑自己的幼稚,可是脾气上来了,就忍不住去伤害
   有时候甚至佩服起自己来,竟然这么久!~
   身边出现了一些人,可是最终还是选择他.因为一份执着吧.
   那些可以天天在一起的恋人们,你们真的很幸福哦.要珍惜呢.
   那些和我一样,仍在坚持着的"单身恋人",你们怎么想呢?
```

</details>

<details>
  <summary>某个 spam 文件</summary>

```
Return-Path: <yi@yahoo.com>
Received: from yahoo.com ([221.221.213.41])
	by spam-gw.ccert.edu.cn (MIMEDefang) with ESMTP id j6RBIx8f032074
	for <qing@ccert.edu.cn>; Wed, 27 Jul 2005 19:19:03 +0800 (CST)
Message-ID: <200507271919.j6RBIx8f032074@spam-gw.ccert.edu.cn>
From: yi@yahoo.com
Subject: =?gb2312?B?MzAw1Kq9qM341b4tsbG+qQ==?=
To: qing@ccert.edu.cn
Content-Type: text/plain;charset="GB2312"
Date: Wed, 27 Jul 2005 19:33:31 +0800
X-Priority: 3
X-Mailer: Microsoft Outlook Express 6.00.2600.0000

300元建网站-北京

为您提供现场服务

综合布线、IC卡门禁与考勤、无限网络与员工监控、网站设计及维护...
只要300元/月，省心又省力，您不动心吗？


东方IT-电脑救援与网管租赁合作倡议书


尊敬的公司负责人：

    我是北京东方IT公司（www.dfit.com.cn/yjy）电脑救援救援俱乐部，面向北京地区广大企、事业单位提供网络安全与出租网管（专职或兼职）人员，您每个月只需要花300元，就可以拥有每月工作4天、随叫随到的属于自己的高水平网管。真正高水准贴心的服务，现已有企事业单位580家之多，比如：麦当劳、司法部法律援助中心、甘家口大厦、北京残疾人联合会、上海电力驻京办、苏州市人民政府驻京办、中国农大生物学院、海开大厦、中国农业生产资料集团、北京商务金融职业学校、时代光华、温地国际中国办事处、西班牙洛拉门迪驻京办、天津阿斯化学驻京办、尚构投资顾问有限公司、京泰大厦、西城区工商局、中国阳光投资公司、北京艾迪尔建筑、英国儿童基金会等等。
    这个网管编制上属于贵公司，同时将以高水平和真正的职业精神为您完成下面事务：
    1、综合布线；2、IC卡门禁与考勤；3、无限网络与员工监控；4、网站设计及维护；4、网络管理；5、网络设备维护；6、单机故障诊断； 7、反病毒；8、防黑客攻击；9、电脑维修及维护；10、企业宽带上网；11、定期维护（数据备份、数据整理、故障排除、硬件清洗等）......

    您现在聘用的网管所干的事情，我们出租的网管比他干得更好，更规范，更可靠！

    干得更好：我们出租的网管工程师全部受过职业网管培训，熟悉网络设备和软、硬件技术，并拥有成熟的工作经验，可以灵活处理各种网络、计算机问题。

    更规范：我们对网络管理常见的数百个问题进行归类整理，形成IT业界绝无独有的知识库，每天对网络工程师轮番培训，使他们的管理更加规范。

    更可靠：我们用我们公司的商誉和出租工程师的技能为您提供双重担保，彻底免除企业后顾之忧。


联系人：毛先生
电话：010-62817129
地址：北京海淀区圆明园西路2号北京5109信箱（邮编：100094）
网址：www.dfit.com.cn或www.dfit.net
Email:mhb@dfit.net
```

</details>

他们的区别很明显，一种是个人记录的，一种是推销产品的。

最后，还有一个“中文停用词表”，这里“停用词”的含义是：语句中的介词、转折词、语气词等，无法表达语句主要含义的词语。

<details>
  <summary>中文停用词表节选：</summary>

```
,
?
、
。
“
”
《
》
！
，
：
；
？
.
(
)
{
}
[
]
<
>
@
+
-
=
*
末##末
啊
阿
哎
哎呀
哎哟
唉
俺
俺们
按
按照
吧
吧哒
把
罢了
被
本
本着
比
比方
比如
鄙人
彼
彼此
边
别
别的
别说
并
并且
```

</details>

基于中文停用词表，可以对上面的文本进行切割，最后得到**有意义的部分**，也就是能代表整个语句的**特征向量**。

> 当某个文本拥有类似的特征向量时，也就能类似的认为，该文本具有相同的结论——比如都是垃圾邮件。

## 2.3 模型训练

# 3 总结
